<!DOCTYPE html>
<html lang="en">
<head>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
</head>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        .imgbox {
                display: grid;
                height: 100%;
            }
            .center-fit {
                max-width: 100%;
                max-height: 100vh;
                margin: auto;
            }
        
        .imagewrap {display:inline-block;position:relative;}
        /*start buttons (css) here*/
        .room_light1{position:absolute;bottom:0%;left:55%;}
        .washbasin_light{position:absolute;bottom:40%;right:10%;}
        .sunlight{position:absolute;right:50%;top:35%;}
        .temperature_sensor{position:absolute;right: 40%;top:60%;}
        .bot {position:absolute;}
    
    </style>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    
    <body  >
    <h2>NEW RESOURCE</h2>
    <h3>(Please use the same name as your topic to subscribe, and if you are referring to the same resource, keep the name constant. DOUBLE CLICK ON THE BUTTON LEADS TO DELETION)</h3>
    <form method="POST" class="post-form">{% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="save btn btn-default" onclick="submit_sensor()">Save</button>
    </form>
    
<div class="imagewrap" id="buttonDivision" onmousemove="showCoords(event)" onmouseout="clearCoor()">
        {% include "room1.svg" %} 
            
            <!start buttons (html) here>
            <button id="demo" style = "position: absolute; top: 20%; left: 40%; background-color: yellow"></button>
            <button id = "reload_data" onclick = "reloadData()">Reload New Data</button>
            
        </div>


        <script type="text/javascript">
        var resourceList;
        var sensorList;
        var actuatorList;
        var botList;
        
        function showCoords(event) {
          var x = event.clientX;
          var y = event.clientY;
          var xPercent = x / $( document ).width() * 100;
          var yPercent = y / $( document ).height() * 100;
          var coor = "X coords: " + (xPercent+13) + ", Y coords: " + (yPercent-10);
          document.getElementById("demo").innerHTML = coor;
        
        }
        
        function clearCoor() {
          document.getElementById("demo").innerHTML = "";
        }
        
        function ajaxCall(){
        $.ajax({
        url: '{% url "getSensorData" %}',
        
        success: function(data){
        data = JSON.parse(data)
        //<!start buttons (jss) here>
        if (sensorList)
        {
         list_len =  sensorList.length;
         console.log("in get sensor data: "+list_len);

         for(i=0; i<list_len; i++)
          { try{
            document.getElementById(sensorList[i].sensor).innerHTML =  sensorList[i].sensor +" : "+ data[sensorList[i].sensor];
              }
            catch(err)
            {
            }
                  }
                 }
                 
         if (actuatorList)
        {
         list_len =  actuatorList.length;
         console.log("in get actuator data: "+list_len);

         for(i=0; i<list_len; i++)
          { try{
            document.getElementById(actuatorList[i].actuator).innerHTML =  actuatorList[i].actuator +" : "+ data[actuatorList[i].actuator];
              }
            catch(err)
            {
            }
            
            }
       
        }
        
         if (botList)
        {
         list_len =  botList.length;
         console.log("in get actuator data: "+list_len);

         for(i=0; i<list_len; i++)
          { try{
            document.getElementById(botList[i].bot).style.top =  data[botList[i].bot][1] + '%';
            document.getElementById(botList[i].bot).style.left =  data[botList[i].bot][0] + '%';
              }
            catch(err)
            {
            }
            
            }
       
        }
        
              }
        
             });
        }
        
        function reloadData(){
         $.ajax({
         url: '{% url "reloadData" %}',
         
         success: function(data){
         data = JSON.parse(data);
         resourceList = data;
         sensorList = data ["sensors"] ;
         actuatorList = data ["actuators"] ;
         botList = data ["bot"];
         
         sensorList_len = sensorList.length;
         actuatorList_len = actuatorList.length;
         botList_len = botList.length;
         
         console.log(sensorList_len);
         console.log(actuatorList_len);
         text="";
         
         for(i=0; i <sensorList_len; i++)
         { text = "<button style = \" position : absolute; top:" + sensorList[i].posy +"%; left:"+ sensorList[i].posx +"%;\" id = \""+sensorList[i].sensor+"\" ondblclick = \" deleteButton(this.id)\" >"+sensorList[i].sensor+"</button>\n";
          document.getElementById("buttonDivision").innerHTML += text;
         
         }
         
         for(i=0; i <actuatorList_len; i++)
         { text = "<button style = \" position : absolute; top:" + actuatorList[i].posy +"%; left:"+ actuatorList[i].posx +"%;\" id = \""+actuatorList[i].actuator+"\" ondblclick = \" deleteButton(this.id)\"  onclick = \"clickActuator(this.id)\" >"+actuatorList[i].actuator+"</button>\n";
          document.getElementById("buttonDivision").innerHTML += text;
         
         }
         
          //text = "<button style = \" position : absolute; top:" + botList[i].posy +"%; left:"+ botList[i].posx +"%;\" id = \""+botList[i].bot+"\" ondblclick = \" deleteButton(this.id)\" >"+botList[i].bot+"</button>\n";
          
         for(i=0; i <botList_len; i++)
         { text = "<button class = \"bot \" id = \""+botList[i].bot+"\" ondblclick = \" deleteButton(this.id)\" >"+botList[i].bot+"</button>\n";
          document.getElementById("buttonDivision").innerHTML += text;
         }
         
         }
         
         });
        }
        
        function clickActuator(buttonID){
        
        $.ajax({
         type: "POST",
         url: '{% url "clickActuator" %}',
         data: { csrfmiddlewaretoken: "{{ csrf_token }}",
                 actuatorName: buttonID
           },
           dataType: "json",
         success: function(){
         console.log("done");
         }
        });
        }
        
        
        function deleteButton(buttonID){ 
        $.ajax({
         type: "POST",
         url: '{% url "deleteSensorData" %}',
         data: { csrfmiddlewaretoken: "{{ csrf_token }}",
                 sensorName: buttonID
           },
           dataType: "json",
         
           success: function(){   document.getElementById(buttonID).remove(); }
          });
        }
        
        
        setInterval(ajaxCall, 1000);
            
            
        </script>
        

    </body>
</html>
